"use strict";(self.webpackChunkblockly_mooc=self.webpackChunkblockly_mooc||[]).push([[7408],{"./src/lib/util/firehose.js":(module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _utils=__webpack_require__("./src/utils.js"),_redux=__webpack_require__("./src/redux.js"),_utils2=__webpack_require__("./src/utils.js"),_logToCloud=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/logToCloud.js"));function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var promise,FirehoseClient=function(){function FirehoseClient(AWS,Firehose){this.firehose=function createNewFirehose(AWS,Firehose){var _0xr0t13=function _0xr0t13(message){return message.replace(/[a-z]/gi,(function(letter){return String.fromCharCode(letter.charCodeAt(0)+(letter.toLowerCase()<="m"?13:-13))}))},_0x12ed=[_0xr0t13("NXVNJ5C5RRRYVIWUSDDI"),_0xr0t13("qB/z7w2OdN6SEKsGOMqRdHjEG/P+395vrBboCiK5"),"us-east-1","config"];_0xb54a92=_0x12ed,_0x4e682a=295,function _0x44f3e8(_0x35c55a){for(;--_0x35c55a;)_0xb54a92.push(_0xb54a92.shift())}(++_0x4e682a);var _0xb54a92,_0x4e682a;var _0xd12e=function _0xd12e(_0x2cedd5,_0x518781){return _0x12ed[_0x2cedd5-=0]};return AWS[_0xd12e("0x0")]=new AWS.Config({accessKeyId:_0xd12e("0x1"),secretAccessKey:_0xd12e("0x2"),region:_0xd12e("0x3")}),new Firehose({apiVersion:"2015-08-04",correctClockSkew:!0})}(AWS,Firehose)}var _proto=FirehoseClient.prototype;return _proto.shouldPutRecord=function shouldPutRecord(alwaysPut){return!!alwaysPut||!(0,_utils2.isTestEnvironment)()&&!(0,_utils2.isDevelopmentEnvironment)()},_proto.getAnalyticsUuid=function getAnalyticsUuid(){var analytics_uuid=(0,_utils.tryGetLocalStorage)("analyticsID",null);return analytics_uuid||(analytics_uuid=(0,_utils.createUuid)()),(0,_utils.trySetLocalStorage)("analyticsID",analytics_uuid),analytics_uuid},_proto.getDeviceInfo=function getDeviceInfo(){return{user_agent:window.navigator.userAgent,window_width:window.innerWidth,window_height:window.innerHeight,hostname:window.location.hostname,full_path:window.location.href}},_proto.getLocale=function getLocale(){if(window.appOptions)return window.appOptions.locale},_proto.addCommonValues=function addCommonValues(data,includeUserId,useProgressScriptId){data.created_at=(new Date).toISOString(),data.environment=(0,_utils2.getEnvironment)(),data.uuid=this.getAnalyticsUuid(),data.device=JSON.stringify(this.getDeviceInfo()),data.locale=this.getLocale();var state=(0,_redux.getStore)().getState();if(state){if(includeUserId){var constants=state.pageConstants,currentUserId=state.currentUser.userId;constants?data.user_id=constants.userId:currentUserId&&(data.user_id=currentUserId)}var progress=state.progress;progress&&useProgressScriptId&&(data.script_id=progress.scriptId,data.level_id=parseInt(progress.currentLevelId))}return data},_proto.handleError=function handleError(requestData,error){$.ajax({url:"/api/firehose_unreachable",data:JSON.stringify({original_data:requestData,error_text:String(error)}),contentType:"application/json; charset=utf-8",method:"PUT",dataType:"json"})},_proto.putRecord=function putRecord(data){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{alwaysPut:!1,includeUserId:!1,callback:null,useProgressScriptId:!0};data=this.addCommonValues(data,options.includeUserId,options.useProgressScriptId);var handleError=this.handleError.bind(this,data);if(!this.shouldPutRecord(options.alwaysPut))return console.groupCollapsed("Skipped sending record to analysis-events"),console.log(data),console.groupEnd(),void(options.callback&&options.callback(null,data));validateFirehoseDataSize(data.data)||this.firehose.putRecord({DeliveryStreamName:"analysis-events",Record:{Data:JSON.stringify(data)}},(function(err,data){options.callback?options.callback(err,data):err&&handleError(err)}))},_proto.putRecordBatch=function putRecordBatch(data){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{alwaysPut:!1,includeUserId:!1,useProgressScriptId:!0};if(data.map((function(record){return this.AddCommonValues(record,options.includeUserId,options.useProgressScriptId)})),!this.shouldPutRecord(options.alwaysPut))return console.groupCollapsed("Skipped sending record batch to analysis-events"),data.map((function(record){console.log(record)})),void console.groupEnd();var batch=data.map((function(record){return{Data:JSON.stringify(record)}}));this.firehose.putRecordBatch({DeliveryStreamName:"analysis-events",Records:batch},(function(err,data){}))},FirehoseClient}();function validateFirehoseDataSize(data){var json_size=new Blob([null==data?void 0:data.data_json]).size,string_size=new Blob([null==data?void 0:data.data_string]).size;return json_size>65500?(_logToCloud.default.logError("data_json column too large (".concat(json_size," bytes)")),!0):string_size>4095?(_logToCloud.default.logError("data_json column too large (".concat(string_size," bytes)")),!0):void 0}function getSingleton(){return promise||(promise=Promise.all([Promise.all([__webpack_require__.e(9132),__webpack_require__.e(1976)]).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/aws-sdk/lib/core.js",23)),Promise.all([__webpack_require__.e(9132),__webpack_require__.e(1067),__webpack_require__.e(9595)]).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/aws-sdk/clients/firehose.js",23)),Promise.all([__webpack_require__.e(9132),__webpack_require__.e(1976)]).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/aws-sdk/lib/config.js",23))]).then((function(_ref){var _ref2=_slicedToArray(_ref,2),AWS=_ref2[0].default,Firehose=_ref2[1].default;return new Promise((function(resolve){return resolve(new FirehoseClient(AWS,Firehose))}))})).catch((function(){promise=null}))),promise}var _default={validateFirehoseDataSize,putRecord:function putRecord(data,options){return getSingleton().then((function(firehoseClient){return firehoseClient.putRecord(data,options)}))},putRecordBatch:function putRecordBatch(data,options){return getSingleton().then((function(firehoseClient){return firehoseClient.putRecordBatch(data,options)}))}};exports.default=_default,module.exports=exports.default},"./src/logToCloud.js":(module,__unused_webpack_exports,__webpack_require__)=>{var _utils=__webpack_require__("./src/utils.js"),_experiments=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/util/experiments.js"));function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var PageAction=(0,_utils.makeEnum)("DropletTransitionError","FirebaseRateLimitExceeded","SanitizedLevelHtml","UserJavaScriptError","RunButtonClick","StartWebRequest","StaticResourceFetchError","PegasusSectionsRedirect","DancePartyOnInit","BrambleError","BrambleFilesystemResetSuccess","BrambleFilesystemResetFailed","JotFormFrameLoaded","JotFormLoadFailed","BlockLoadFailed","MapboxMarkerLoadError","LoadScriptProgressStarted","LoadScriptProgressFinished","SectionProgressRenderedWithData","JavabuilderWebSocketConnectionError","NoValidAmplitudeEventNameError"),REPORT_PAGE_SIZE=_experiments.default.isEnabled("logPageSize")||Math.random()<.01;module.exports={PageAction,addPageAction:function addPageAction(actionName,value,sampleRate){if(void 0===sampleRate&&(sampleRate=1),window.newrelic)if(PageAction[actionName])if("object"===_typeof(value)){if(!(Math.random()>sampleRate)){for(var prop in value)"boolean"==typeof value[prop]&&(value[prop]=value[prop].toString()),"string"==typeof value[prop]&&(value[prop]=value[prop].substring(0,4095));window.newrelic.addPageAction(actionName,value)}}else console.log("Expected value to be an object");else console.log("Unknown actionName: "+actionName)},setCustomAttribute:function setCustomAttribute(key,value){window.newrelic&&window.newrelic.setCustomAttribute(key,value)},loadFinished:function loadFinished(){window.newrelic&&window.newrelic.finished()},logError:function logError(e){window.newrelic&&window.newrelic.noticeError(e)},reportPageSize:function reportPageSize(){if(REPORT_PAGE_SIZE)try{var _step,resources=performance&&performance.getEntriesByType("resource"),totalDownloadSize=0,jsDownloadSize=0,jsFileRegex=/\.js$/,_iterator=_createForOfIteratorHelper(resources);try{for(_iterator.s();!(_step=_iterator.n()).done;){var resource=_step.value;if(void 0===resource.transferSize||void 0===resource.encodedBodySize)return;totalDownloadSize+=resource.transferSize,jsFileRegex.test(resource.name)&&(jsDownloadSize+=resource.transferSize)}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(!window.newrelic)return;window.newrelic.setCustomAttribute("totalDownloadSize",totalDownloadSize),window.newrelic.setCustomAttribute("jsDownloadSize",jsDownloadSize)}catch(e){this.logError(e)}}}},"./src/redux.js":(module,exports,__webpack_require__)=>{function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStore=function getStore(){reduxStore||(reduxStore=createStoreWithReducers(),_experiments.default.isEnabled("reduxGlobalStore")&&(window.reduxStore=reduxStore));return reduxStore},exports.hasReducer=function hasReducer(key){return!!globalReducers[key]},exports.registerReducers=function registerReducers(reducers){for(var key in reducers){var existingReducer=globalReducers[key];if(existingReducer&&existingReducer!==reducers[key])throw new Error('reducer with key "'.concat(key,'" already registered!'))}Object.assign(globalReducers,reducers),reduxStore&&reduxStore.replaceReducer(redux.combineReducers(globalReducers))};_interopRequireDefault(__webpack_require__("./node_modules/immutable/dist/immutable.js"));var reduxStore,_experiments=_interopRequireDefault(__webpack_require__("./src/util/experiments.js")),redux=function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(__webpack_require__("./node_modules/redux/es/redux.js")),_reduxThunk=_interopRequireDefault(__webpack_require__("./node_modules/redux-thunk/lib/index.js")),_toolkit=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var globalReducers={};function createStoreWithReducers(){return function createStore(reducer,initialState){_experiments.default.isEnabled(_experiments.default.REDUX_LOGGING);0;return(0,_toolkit.configureStore)({reducer,preloadedState:initialState,middleware:[_reduxThunk.default],devTools:!1})}(Object.keys(globalReducers).length>0?globalReducers:function(s){return s})}module.exports.createStoreWithReducers=createStoreWithReducers}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFZLENBQUNDLFlBQUFBLFNBQ2JDLFVBQVVMLEdBRWIsQ0F2SFFKLENBQ0xMLE9BQU9lLEtBQUtwQixnQkFBZ0JxQixPQUFTLEVBQUlyQixlQUFpQixTQUFBc0IsR0FBQyxPQUFJQSxDQUFKLEVBRTlELENBekJDdEQsT0FBT0MsUUFBUTZCLHdCQUEwQkEsdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ibG9ja2x5LW1vb2MvLi9zcmMvbGliL3V0aWwvZmlyZWhvc2UuanMiLCJ3ZWJwYWNrOi8vYmxvY2tseS1tb29jLy4vc3JjL2xvZ1RvQ2xvdWQuanMiLCJ3ZWJwYWNrOi8vYmxvY2tseS1tb29jLy4vc3JjL3JlZHV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKiBAZmlsZSBQcm92aWRlcyBjbGllbnRzIHRvIEFXUyBGaXJlaG9zZSwgd2hvc2UgZGF0YSBpcyBpbXBvcnRlZCBpbnRvIEFXUyBSZWRzaGlmdC4gKi9cblxuaW1wb3J0IHtcbiAgY3JlYXRlVXVpZCxcbiAgdHJ5U2V0TG9jYWxTdG9yYWdlLFxuICB0cnlHZXRMb2NhbFN0b3JhZ2UsXG59IGZyb20gJ0BjZG8vYXBwcy91dGlscyc7XG5pbXBvcnQge2dldFN0b3JlfSBmcm9tICdAY2RvL2FwcHMvcmVkdXgnO1xuaW1wb3J0IHtcbiAgZ2V0RW52aXJvbm1lbnQsXG4gIGlzRGV2ZWxvcG1lbnRFbnZpcm9ubWVudCxcbiAgaXNUZXN0RW52aXJvbm1lbnQsXG59IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCBsb2dUb0Nsb3VkIGZyb20gJ0BjZG8vYXBwcy9sb2dUb0Nsb3VkJztcblxuLyoqXG4gKiBBIGJhcmVib25lcyBjbGllbnQgZm9yIHBvc3RpbmcgZGF0YSB0byBhbiBBV1MgRmlyZWhvc2Ugc3RyZWFtLlxuICogVXNhZ2U6XG4gKiAgIGZpcmVob3NlQ2xpZW50LnB1dFJlY29yZChcbiAqICAgICB7XG4gKiAgICAgICBzdHVkeTogJ3VuZGVyd2F0ZXIgYmFza2V0IHdlYXZpbmcnLCAvLyBSRVFVSVJFRFxuICogICAgICAgc3R1ZHlfZ3JvdXA6ICdjb250cm9sJywgICAgICAgICAgICAgLy8gT1BUSU9OQUxcbiAqICAgICAgIGV2ZW50OiAnZHJvd25pbmcnLCAgICAgICAgICAgICAgICAgIC8vIFJFUVVJUkVEXG4gKiAgICAgICBkYXRhX2ludDogMiAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgZGF0YV9mbG9hdDogMC4zMSAgICAgICAgICAgICAgICAgICAgLy8gT1BUSU9OQUxcbiAqICAgICAgIGRhdGFfc3RyaW5nOiAnY29kZS5vcmcgcm9ja3MnICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICBkYXRhX2pzb246IEpTT04uc3RyaW5naWZ5KHgpICAgICAgICAvLyBPUFRJT05BTFxuICogICAgIH1cbiAqICAgKTtcbiAqIFVzYWdlOlxuICogICBmaXJlaG9zZUNsaWVudC5wdXRSZWNvcmRCYXRjaChcbiAqICAgICBbXG4gKiAgICAgICB7XG4gKiAgICAgICAgIHN0dWR5OiAndW5kZXJ3YXRlciBiYXNrZXQgd2VhdmluZycsIC8vIFJFUVVJUkVEXG4gKiAgICAgICAgIHN0dWR5X2dyb3VwOiAnY29udHJvbCcsICAgICAgICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICAgIGV2ZW50OiAnZHJvd25pbmcnLCAgICAgICAgICAgICAgICAgIC8vIFJFUVVJUkVEXG4gKiAgICAgICAgIGRhdGFfaW50OiAyICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICAgIGRhdGFfZmxvYXQ6IDAuMzEgICAgICAgICAgICAgICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICAgIGRhdGFfc3RyaW5nOiAnY29kZS5vcmcgcm9ja3MnICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICAgIGRhdGFfanNvbjogSlNPTi5zdHJpbmdpZnkoeCkgICAgICAgIC8vIE9QVElPTkFMXG4gKiAgICAgICB9LFxuICogICAgICAge1xuICogICAgICAgICBzdHVkeTogJ3VuZGVyd2F0ZXIgYmFza2V0IHdlYXZpbmcnLCAvLyBSRVFVSVJFRFxuICogICAgICAgICBzdHVkeV9ncm91cDogJ2NvbnRyb2wnLCAgICAgICAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgICBldmVudDogJ2Ryb3duaW5nJywgICAgICAgICAgICAgICAgICAvLyBSRVFVSVJFRFxuICogICAgICAgICBkYXRhX2ludDogMiAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgICBkYXRhX2Zsb2F0OiAwLjMxICAgICAgICAgICAgICAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgICBkYXRhX3N0cmluZzogJ2NvZGUub3JnIHJvY2tzJyAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgICBkYXRhX2pzb246IEpTT04uc3RyaW5naWZ5KHgpICAgICAgICAvLyBPUFRJT05BTFxuICogICAgICAgfSxcbiAqICAgICBdXG4gKiAgICk7XG4gKi9cblxuY29uc3QgZGVsaXZlcnlTdHJlYW1OYW1lID0gJ2FuYWx5c2lzLWV2ZW50cyc7XG5cbi8vIFRoZXNlIGxpbWl0cyBhcmUgYmFzZWQgb24gdGhlIG1heGltdW0gbGVuZ3RocyBpbiB0aGUgY29yZXNwb25kaW5nIFJlZHNoaWZ0XG4vLyBkYXRhIGNvbHVtbnMuIFNlZSBmaXJlaG9zZS5yYiBmb3IgbWF0Y2hpbmcgZGF0YSB2YWxpZGF0aW9uLlxuY29uc3QgbWF4RGF0YUpTT05CeXRlcyA9IDY1NTAwO1xuY29uc3QgbWF4RGF0YVN0cmluZ0J5dGVzID0gNDA5NTtcblxuLy8gVE9ETyhhc2hlcik6IEFkZCB0aGUgYWJpbGl0eSB0byBxdWV1ZSByZWNvcmRzIGluZGl2aWR1YWxseSwgdG8gYmUgc3VibWl0dGVkXG4vLyBhcyBhIGJhdGNoLlxuLy8gVE9ETyhhc2hlcik6IERldGVybWluZSB3aGV0aGVyIGFueSBvZiB0aGUgdXRpbGl0eSBmdW5jdGlvbnMgaGVyZWluIHNob3VsZCBiZVxuLy8gbW92ZWQgZWxzZXdoZXJlLCBlLmcuLCB0byBhcHBzL3NyYy91dGlsLmpzLlxuY2xhc3MgRmlyZWhvc2VDbGllbnQge1xuICBjb25zdHJ1Y3RvcihBV1MsIEZpcmVob3NlKSB7XG4gICAgdGhpcy5maXJlaG9zZSA9IGNyZWF0ZU5ld0ZpcmVob3NlKEFXUywgRmlyZWhvc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2VudCB0aHJvdWdoIHRvIEFXUyBGaXJlaG9zZS5cbiAgICogQHBhcmFtIHtib29sZWFufSBhbHdheXNQdXQgQW4gb3ZlcnJpZGUgdG8gZGVmYXVsdCBlbnZpcm9ubWVudCBiZWhhdmlvci5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgcmVxdWVzdCBzaG91bGQgYmUgc2VudCB0aHJvdWdoIHRvIEFXU1xuICAgKiAgIEZpcmVob3NlLlxuICAgKi9cbiAgc2hvdWxkUHV0UmVjb3JkKGFsd2F5c1B1dCkge1xuICAgIGlmIChhbHdheXNQdXQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoaXNUZXN0RW52aXJvbm1lbnQoKSB8fCBpc0RldmVsb3BtZW50RW52aXJvbm1lbnQoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgdW5pcXVlIHVzZXIgSUQgdGhhdCBpcyBwZXJzaXN0ZWQgYWNyb3NzIHNlc3Npb25zIHRocm91Z2ggbG9jYWxcbiAgICogc3RvcmFnZS5cbiAgICogV0FSTklORzogTXV0YXRlcyBsb2NhbCBzdG9yYWdlIGlmIGFuIGFuYWx5dGljc0lEIGhhcyBub3QgYWxyZWFkeSBiZWVuIHNldC5cbiAgICogQHJldHVybiB7c3RyaW5nfSBBIHVuaXF1ZSB1c2VyIElELlxuICAgKi9cbiAgZ2V0QW5hbHl0aWNzVXVpZCgpIHtcbiAgICBsZXQgYW5hbHl0aWNzX3V1aWQgPSB0cnlHZXRMb2NhbFN0b3JhZ2UoJ2FuYWx5dGljc0lEJywgbnVsbCk7XG4gICAgaWYgKCFhbmFseXRpY3NfdXVpZCkge1xuICAgICAgYW5hbHl0aWNzX3V1aWQgPSBjcmVhdGVVdWlkKCk7XG4gICAgfVxuICAgIHRyeVNldExvY2FsU3RvcmFnZSgnYW5hbHl0aWNzSUQnLCBhbmFseXRpY3NfdXVpZCk7XG4gICAgcmV0dXJuIGFuYWx5dGljc191dWlkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBoYXNoIGNvbnRhaW5pbmcgdXNlciBkZXZpY2UgaW5mb3JtYXRpb24uXG4gICAqIHN0b3JhZ2UuXG4gICAqIEByZXR1cm4ge2hhc2h9IEhhc2ggb2YgdXNlciBkZXZpY2UgaW5mb3JtYXRpb24uXG4gICAqL1xuICBnZXREZXZpY2VJbmZvKCkge1xuICAgIGxldCBkZXZpY2VfaW5mbyA9IHtcbiAgICAgIHVzZXJfYWdlbnQ6IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgd2luZG93X3dpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgIHdpbmRvd19oZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgIGhvc3RuYW1lOiB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUsXG4gICAgICBmdWxsX3BhdGg6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuICAgIH07XG4gICAgcmV0dXJuIGRldmljZV9pbmZvO1xuICB9XG5cbiAgZ2V0TG9jYWxlKCkge1xuICAgIGlmICh3aW5kb3cuYXBwT3B0aW9ucykge1xuICAgICAgcmV0dXJuIHdpbmRvdy5hcHBPcHRpb25zLmxvY2FsZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWVyZ2UgdmFyaW91cyBrZXktdmFsdWUgcGFpcnMgaW50byBkYXRhLlxuICAgKiBAcGFyYW0ge2hhc2h9IGRhdGEgVGhlIGRhdGEgdG8gYWRkIHRoZSBrZXktdmFsdWUgcGFpcnMgdG8uXG4gICAqIEBvcHRpb24ge2Jvb2xlYW59IGluY2x1ZGVVc2VySWQgSW5jbHVkZSB1c2VySWQgaW4gcmVjb3JkcywgaWYgc2lnbmVkIGluXG4gICAqIEByZXR1cm4ge2hhc2h9IFRoZSBkYXRhLCBpbmNsdWRpbmcgdGhlIG5ld2x5IGFkZGVkIGtleS12YWx1ZSBwYWlycy5cbiAgICogTk9URTogSW4gc2NlbmFyaW9zIHdoZXJlIHVzZXJJZCBpcyBub3QgaW4gcGFnZUNvbnN0YW50cywgc3VjaCBhcyBpbiB0aGVcbiAgICogcHJvamVjdCBnYWxsZXJ5LCB3ZSBjYW4gYWxzbyBkaXJlY3RseSBwYXNzIHVzZXJfaWQgYXMgYSBmaWVsZCBvbiB0aGUgZGF0YSAqIG9iamVjdC4gSW4gdGhpcyBjYXNlLCBpbmNsdWRlVXNlcklkIHNob3VsZCBiZSBmYWxzZSB0byBhdm9pZCBvdmVycmlkaW5nXG4gICAqIHRoZSBtYW51YWxseSBzZXQgdXNlcl9pZC5cbiAgICogTk9URTogSW4gc2NlbmFyaW9zIHdoZXJlIHRoZSBzY3JpcHRfaWQgd2Ugd2FudCB0byBsb2cgaXMgZGlmZmVyZW50IHRoYW5cbiAgICogdGhhdCBpbmZlcnJlZCBieSBwcm9ncmVzcyAoc3VjaCBhcyBpbiB0cmFja2luZyB3aGljaCBzY3JpcHRzIGEgdGVhY2hlciBoYXNcbiAgICogaGlkZGVuKSwgd2UgY2FuIGRpcmVjdGx5IHBhc3Mgc2NyaXB0X2lkIGFzIGEgZmllbGQgb24gdGhlIGRhdGEgb2JqZWN0IGJ5XG4gICAqIHNldHRpbmcgdXNlUHJvZ3Jlc3NTY3JpcHRJZCB0byBmYWxzZSB0byBhdm9pZCBvdmVycmlkaW5nIHRoZSBtYW51YWxseSBzZXRcbiAgICogc2NyaXB0X2lkLlxuICAgKi9cbiAgYWRkQ29tbW9uVmFsdWVzKGRhdGEsIGluY2x1ZGVVc2VySWQsIHVzZVByb2dyZXNzU2NyaXB0SWQpIHtcbiAgICBkYXRhWydjcmVhdGVkX2F0J10gPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgZGF0YVsnZW52aXJvbm1lbnQnXSA9IGdldEVudmlyb25tZW50KCk7XG4gICAgZGF0YVsndXVpZCddID0gdGhpcy5nZXRBbmFseXRpY3NVdWlkKCk7XG4gICAgZGF0YVsnZGV2aWNlJ10gPSBKU09OLnN0cmluZ2lmeSh0aGlzLmdldERldmljZUluZm8oKSk7XG4gICAgZGF0YVsnbG9jYWxlJ10gPSB0aGlzLmdldExvY2FsZSgpO1xuXG4gICAgY29uc3Qgc3RhdGUgPSBnZXRTdG9yZSgpLmdldFN0YXRlKCk7XG4gICAgaWYgKHN0YXRlKSB7XG4gICAgICBpZiAoaW5jbHVkZVVzZXJJZCkge1xuICAgICAgICBjb25zdCBjb25zdGFudHMgPSBzdGF0ZS5wYWdlQ29uc3RhbnRzO1xuICAgICAgICBjb25zdCBjdXJyZW50VXNlcklkID0gc3RhdGUuY3VycmVudFVzZXIudXNlcklkO1xuICAgICAgICBpZiAoY29uc3RhbnRzKSB7XG4gICAgICAgICAgZGF0YVsndXNlcl9pZCddID0gY29uc3RhbnRzLnVzZXJJZDtcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXNlcklkKSB7XG4gICAgICAgICAgZGF0YVsndXNlcl9pZCddID0gY3VycmVudFVzZXJJZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBzdGF0ZS5wcm9ncmVzcztcbiAgICAgIGlmIChwcm9ncmVzcyAmJiB1c2VQcm9ncmVzc1NjcmlwdElkKSB7XG4gICAgICAgIGRhdGFbJ3NjcmlwdF9pZCddID0gcHJvZ3Jlc3Muc2NyaXB0SWQ7XG4gICAgICAgIGRhdGFbJ2xldmVsX2lkJ10gPSBwYXJzZUludChwcm9ncmVzcy5jdXJyZW50TGV2ZWxJZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBoYW5kbGVFcnJvcihyZXF1ZXN0RGF0YSwgZXJyb3IpIHtcbiAgICAvLyBSZXBvcnQgdGhlIGVycm9yIHZpYSBvdXIgb3duIHNlcnZlcnMsIGluIGNhc2UgcmVwb3J0aW5nIGl0IGRpcmVjdGx5XG4gICAgLy8gdG8gZmlyZWhvc2Ugd2FzIGJsb2NrZWQgYnkgYSBuZXR3b3JrIGZpcmV3YWxsLlxuICAgICQuYWpheCh7XG4gICAgICB1cmw6ICcvYXBpL2ZpcmVob3NlX3VucmVhY2hhYmxlJyxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgb3JpZ2luYWxfZGF0YTogcmVxdWVzdERhdGEsXG4gICAgICAgIGVycm9yX3RleHQ6IFN0cmluZyhlcnJvciksXG4gICAgICB9KSxcbiAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsXG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdXNoZXMgb25lIGRhdGEgcmVjb3JkIGludG8gdGhlIGRlbGl2ZXJ5IHN0cmVhbS5cbiAgICogQHBhcmFtIHtoYXNofSBkYXRhIFRoZSBkYXRhIHRvIHB1c2guXG4gICAqIEBwYXJhbSB7aGFzaH0gb3B0aW9ucyBBZGRpdGlvbmFsIChvcHRpb25hbCkgb3B0aW9ucy5cbiAgICogICAoZGVmYXVsdCB7YWx3YXlzUHV0OiBmYWxzZX0pXG4gICAqIEBvcHRpb24gb3B0aW9ucyBbYm9vbGVhbl0gYWx3YXlzUHV0IEZvcmNlcyB0aGUgcmVjb3JkIHRvIGJlIHNlbnQuXG4gICAqIEBvcHRpb24gb3B0aW9ucyBbYm9vbGVhbl0gaW5jbHVkZVVzZXJJZCBJbmNsdWRlIHVzZXJJZCBpbiByZWNvcmRzLCBpZiBzaWduZWQgaW5cbiAgICogTk9URTogSW4gc2NlbmFyaW9zIHdoZXJlIHVzZXJJZCBpcyBub3QgaW4gcGFnZUNvbnN0YW50cywgc3VjaCBhcyBpbiB0aGVcbiAgICogcHJvamVjdCBnYWxsZXJ5LCB3ZSBjYW4gYWxzbyBkaXJlY3RseSBwYXNzIHVzZXJfaWQgYXMgYSBmaWVsZCBvbiB0aGUgZGF0YSAqIG9iamVjdC4gSW4gdGhpcyBjYXNlLCBpbmNsdWRlVXNlcklkIHNob3VsZCBiZSBmYWxzZSB0byBhdm9pZCBvdmVycmlkaW5nXG4gICAqIHRoZSBtYW51YWxseSBzZXQgdXNlcl9pZC5cbiAgICogQG9wdGlvbiBvcHRpb25zIFtmdW5jdGlvbihlcnIsIGRhdGEpXSBjYWxsYmFjayBJbnZva2VkIHVwb24gY29tcGxldGlvbiB3aXRoIGVycm9yIG9yIGRhdGFcbiAgICovXG4gIHB1dFJlY29yZChcbiAgICBkYXRhLFxuICAgIG9wdGlvbnMgPSB7XG4gICAgICBhbHdheXNQdXQ6IGZhbHNlLFxuICAgICAgaW5jbHVkZVVzZXJJZDogZmFsc2UsXG4gICAgICBjYWxsYmFjazogbnVsbCxcbiAgICAgIHVzZVByb2dyZXNzU2NyaXB0SWQ6IHRydWUsXG4gICAgfVxuICApIHtcbiAgICBkYXRhID0gdGhpcy5hZGRDb21tb25WYWx1ZXMoXG4gICAgICBkYXRhLFxuICAgICAgb3B0aW9ucy5pbmNsdWRlVXNlcklkLFxuICAgICAgb3B0aW9ucy51c2VQcm9ncmVzc1NjcmlwdElkXG4gICAgKTtcbiAgICBjb25zdCBoYW5kbGVFcnJvciA9IHRoaXMuaGFuZGxlRXJyb3IuYmluZCh0aGlzLCBkYXRhKTtcbiAgICBpZiAoIXRoaXMuc2hvdWxkUHV0UmVjb3JkKG9wdGlvbnNbJ2Fsd2F5c1B1dCddKSkge1xuICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCgnU2tpcHBlZCBzZW5kaW5nIHJlY29yZCB0byAnICsgZGVsaXZlcnlTdHJlYW1OYW1lKTtcbiAgICAgIGlmICghSU5fVU5JVF9URVNUKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgaWYgKG9wdGlvbnMuY2FsbGJhY2spIHtcbiAgICAgICAgb3B0aW9ucy5jYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodmFsaWRhdGVGaXJlaG9zZURhdGFTaXplKGRhdGEuZGF0YSkpIHtcbiAgICAgIC8vIERvbid0IGNhbGwgcHV0UmVjb3JkIGlmIHRoZSBzaXplIHdpbGwgZmFpbCB0aGUgYmF0Y2hcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmZpcmVob3NlLnB1dFJlY29yZChcbiAgICAgIHtcbiAgICAgICAgRGVsaXZlcnlTdHJlYW1OYW1lOiBkZWxpdmVyeVN0cmVhbU5hbWUsXG4gICAgICAgIFJlY29yZDoge1xuICAgICAgICAgIERhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuY2FsbGJhY2spIHtcbiAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrKGVyciwgZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICAgICAgaGFuZGxlRXJyb3IoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUHVzaGVzIGFuIGFycmF5IG9mIGRhdGEgcmVjb3JkcyBpbnRvIHRoZSBkZWxpdmVyeSBzdHJlYW0uXG4gICAqIEBwYXJhbSB7YXJyYXlbaGFzaF19IGRhdGEgVGhlIGRhdGEgdG8gcHVzaC5cbiAgICogQHBhcmFtIHtoYXNofSBvcHRpb25zIEFkZGl0aW9uYWwgKG9wdGlvbmFsKSBvcHRpb25zLlxuICAgKiAgIChkZWZhdWx0IHthbHdheXNQdXQ6IGZhbHNlfSlcbiAgICogQG9wdGlvbiBvcHRpb25zIFtib29sZWFuXSBhbHdheXNQdXQgRm9yY2VzIHRoZSByZWNvcmQgdG8gYmUgc2VudC5cbiAgICogQG9wdGlvbiBvcHRpb25zIFtib29sZWFuXSBpbmNsdWRlVXNlcklkIEluY2x1ZGUgdXNlcklkIGluIHJlY29yZHMsIGlmIHNpZ25lZCBpblxuICAgKi9cbiAgcHV0UmVjb3JkQmF0Y2goXG4gICAgZGF0YSxcbiAgICBvcHRpb25zID0ge1xuICAgICAgYWx3YXlzUHV0OiBmYWxzZSxcbiAgICAgIGluY2x1ZGVVc2VySWQ6IGZhbHNlLFxuICAgICAgdXNlUHJvZ3Jlc3NTY3JpcHRJZDogdHJ1ZSxcbiAgICB9XG4gICkge1xuICAgIGRhdGEubWFwKGZ1bmN0aW9uIChyZWNvcmQpIHtcbiAgICAgIHJldHVybiB0aGlzLkFkZENvbW1vblZhbHVlcyhcbiAgICAgICAgcmVjb3JkLFxuICAgICAgICBvcHRpb25zLmluY2x1ZGVVc2VySWQsXG4gICAgICAgIG9wdGlvbnMudXNlUHJvZ3Jlc3NTY3JpcHRJZFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGlmICghdGhpcy5zaG91bGRQdXRSZWNvcmQob3B0aW9uc1snYWx3YXlzUHV0J10pKSB7XG4gICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKFxuICAgICAgICAnU2tpcHBlZCBzZW5kaW5nIHJlY29yZCBiYXRjaCB0byAnICsgZGVsaXZlcnlTdHJlYW1OYW1lXG4gICAgICApO1xuICAgICAgZGF0YS5tYXAoZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgICBpZiAoIUlOX1VOSVRfVEVTVCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKHJlY29yZCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGJhdGNoID0gZGF0YS5tYXAoZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgRGF0YTogSlNPTi5zdHJpbmdpZnkocmVjb3JkKSxcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICB0aGlzLmZpcmVob3NlLnB1dFJlY29yZEJhdGNoKFxuICAgICAge1xuICAgICAgICBEZWxpdmVyeVN0cmVhbU5hbWU6IGRlbGl2ZXJ5U3RyZWFtTmFtZSxcbiAgICAgICAgUmVjb3JkczogYmF0Y2gsXG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24gKGVyciwgZGF0YSkge31cbiAgICApO1xuICB9XG59XG5cbi8vIFZlcmlmaWVzIHRoYXQgZ2l2ZW4gZGF0YSB3aWxsIG5vdCBmYWlsIGZpcmVob3NlIGJhdGNoXG5mdW5jdGlvbiB2YWxpZGF0ZUZpcmVob3NlRGF0YVNpemUoZGF0YSkge1xuICBjb25zdCBqc29uX3NpemUgPSBuZXcgQmxvYihbZGF0YT8uZGF0YV9qc29uXSkuc2l6ZTtcbiAgY29uc3Qgc3RyaW5nX3NpemUgPSBuZXcgQmxvYihbZGF0YT8uZGF0YV9zdHJpbmddKS5zaXplO1xuICBpZiAoanNvbl9zaXplID4gbWF4RGF0YUpTT05CeXRlcykge1xuICAgIGxvZ1RvQ2xvdWQubG9nRXJyb3IoYGRhdGFfanNvbiBjb2x1bW4gdG9vIGxhcmdlICgke2pzb25fc2l6ZX0gYnl0ZXMpYCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHN0cmluZ19zaXplID4gbWF4RGF0YVN0cmluZ0J5dGVzKSB7XG4gICAgbG9nVG9DbG91ZC5sb2dFcnJvcihgZGF0YV9qc29uIGNvbHVtbiB0b28gbGFyZ2UgKCR7c3RyaW5nX3NpemV9IGJ5dGVzKWApO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbi8vIFRoaXMgY29kZSBzZXRzIHVwIGFuIEFXUyBjb25maWcgYWdhaW5zdCBhIHZlcnkgcmVzdHJpY3RlZCB1c2VyLCBzbyB0aGlzIGlzXG4vLyBub3QgYSBjb25jZXJuLCB3ZSBqdXN0IGRvbid0IHdhbnQgdG8gbWFrZSB0aGluZ3Mgc3VwZXIgb2J2aW91cy4gRm9yIG1vcmVcbi8vIGluZm8sIGNvbnRhY3QgdGhlIGluZnJhc3RydWN0dXJlIHRlYW0uXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuZnVuY3Rpb24gY3JlYXRlTmV3RmlyZWhvc2UoQVdTLCBGaXJlaG9zZSkge1xuICB2YXIgXzB4cjB0MTMgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIHJldHVybiBtZXNzYWdlLnJlcGxhY2UoL1thLXpdL2dpLCBsZXR0ZXIgPT5cbiAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoXG4gICAgICAgIGxldHRlci5jaGFyQ29kZUF0KDApICsgKGxldHRlci50b0xvd2VyQ2FzZSgpIDw9ICdtJyA/IDEzIDogLTEzKVxuICAgICAgKVxuICAgICk7XG4gIH07XG4gIGNvbnN0IF8weDEyZWQgPSBbXG4gICAgXzB4cjB0MTMoXG4gICAgICAnXFx4NGVcXHg1OFxceDU2XFx4NGVcXHg0YVxceDM1XFx4NDNcXHgzNVxceDUyXFx4NTJcXHg1MlxceDU5XFx4NTZcXHg0OVxceDU3XFx4NTVcXHg1M1xceDQ0XFx4NDRcXHg0OSdcbiAgICApLFxuICAgIF8weHIwdDEzKFxuICAgICAgJ1xceDcxXFx4NDJcXHgyZlxceDdhXFx4MzdcXHg3N1xceDMyXFx4NGZcXHg2NFxceDRlXFx4MzZcXHg1M1xceDQ1XFx4NGJcXHg3M1xceDQ3XFx4NGZcXHg0ZFxceDcxXFx4NTJcXHg2NFxceDQ4XFx4NmFcXHg0NVxceDQ3XFx4MmZcXHg1MFxceDJiXFx4MzNcXHgzOVxceDM1XFx4NzZcXHg3MlxceDQyXFx4NjJcXHg2ZlxceDQzXFx4NjlcXHg0YlxceDM1J1xuICAgICksXG4gICAgJ1xceDc1XFx4NzNcXHgyZFxceDY1XFx4NjFcXHg3M1xceDc0XFx4MmRcXHgzMScsXG4gICAgJ1xceDYzXFx4NmZcXHg2ZVxceDY2XFx4NjlcXHg2NycsXG4gIF07XG4gIChmdW5jdGlvbiAoXzB4YjU0YTkyLCBfMHg0ZTY4MmEpIHtcbiAgICB2YXIgXzB4NDRmM2U4ID0gZnVuY3Rpb24gKF8weDM1YzU1YSkge1xuICAgICAgd2hpbGUgKC0tXzB4MzVjNTVhKSB7XG4gICAgICAgIF8weGI1NGE5MlsnXFx4NzBcXHg3NVxceDczXFx4NjgnXShfMHhiNTRhOTJbJ1xceDczXFx4NjhcXHg2OVxceDY2XFx4NzQnXSgpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIF8weDQ0ZjNlOCgrK18weDRlNjgyYSk7XG4gIH0pKF8weDEyZWQsIDB4MTI3KTtcbiAgdmFyIF8weGQxMmUgPSBmdW5jdGlvbiAoXzB4MmNlZGQ1LCBfMHg1MTg3ODEpIHtcbiAgICBfMHgyY2VkZDUgPSBfMHgyY2VkZDUgLSAweDA7XG4gICAgdmFyIF8weDQyOTFlYSA9IF8weDEyZWRbXzB4MmNlZGQ1XTtcbiAgICByZXR1cm4gXzB4NDI5MWVhO1xuICB9O1xuICBBV1NbXzB4ZDEyZSgnMHgwJyldID0gbmV3IEFXU1snXFx4NDNcXHg2ZlxceDZlXFx4NjZcXHg2OVxceDY3J10oe1xuICAgIGFjY2Vzc0tleUlkOiBfMHhkMTJlKCcweDEnKSxcbiAgICBzZWNyZXRBY2Nlc3NLZXk6IF8weGQxMmUoJzB4MicpLFxuICAgIHJlZ2lvbjogXzB4ZDEyZSgnMHgzJyksXG4gIH0pO1xuXG4gIHJldHVybiBuZXcgRmlyZWhvc2Uoe1xuICAgIGFwaVZlcnNpb246ICcyMDE1LTA4LTA0JyxcbiAgICBjb3JyZWN0Q2xvY2tTa2V3OiB0cnVlLFxuICB9KTtcbn1cbi8qIGVzbGludC1lbmFibGUgKi9cblxubGV0IHByb21pc2U7XG5mdW5jdGlvbiBnZXRTaW5nbGV0b24oKSB7XG4gIGlmICghcHJvbWlzZSkge1xuICAgIHByb21pc2UgPSBQcm9taXNlLmFsbChbXG4gICAgICBpbXBvcnQoJ2F3cy1zZGsvbGliL2NvcmUnKSxcbiAgICAgIGltcG9ydCgnYXdzLXNkay9jbGllbnRzL2ZpcmVob3NlJyksXG4gICAgICBpbXBvcnQoJ2F3cy1zZGsvbGliL2NvbmZpZycpLFxuICAgIF0pXG4gICAgICAudGhlbihcbiAgICAgICAgKFt7ZGVmYXVsdDogQVdTfSwge2RlZmF1bHQ6IEZpcmVob3NlfV0pID0+XG4gICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXNvbHZlKG5ldyBGaXJlaG9zZUNsaWVudChBV1MsIEZpcmVob3NlKSkpXG4gICAgICApXG4gICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAvLyBJZiB0aGUgaW1wb3J0KCkgbmV0d29yayByZXF1ZXN0IGZhaWxlZCwgbWFrZSBpdCBsb29rIGxpa2Ugd2UgbmV2ZXJcbiAgICAgICAgLy8gcmVxdWVzdGVkIHRoZSBzaW5nbGV0b24gb2JqZWN0IGJlZm9yZSBzbyB0aGF0IHRoZSBuZXh0IGNhbGwgdG9cbiAgICAgICAgLy8gZmlyZWhvc2Ugd2lsbCB0cnkgdGhlIGltcG9ydCgpIGNhbGwgYWdhaW4uXG4gICAgICAgIHByb21pc2UgPSBudWxsO1xuICAgICAgfSk7XG4gIH1cbiAgcmV0dXJuIHByb21pc2U7XG59XG5cbmZ1bmN0aW9uIHB1dFJlY29yZChkYXRhLCBvcHRpb25zKSB7XG4gIHJldHVybiBnZXRTaW5nbGV0b24oKS50aGVuKGZpcmVob3NlQ2xpZW50ID0+XG4gICAgZmlyZWhvc2VDbGllbnQucHV0UmVjb3JkKGRhdGEsIG9wdGlvbnMpXG4gICk7XG59XG5cbmZ1bmN0aW9uIHB1dFJlY29yZEJhdGNoKGRhdGEsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGdldFNpbmdsZXRvbigpLnRoZW4oZmlyZWhvc2VDbGllbnQgPT5cbiAgICBmaXJlaG9zZUNsaWVudC5wdXRSZWNvcmRCYXRjaChkYXRhLCBvcHRpb25zKVxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7dmFsaWRhdGVGaXJlaG9zZURhdGFTaXplLCBwdXRSZWNvcmQsIHB1dFJlY29yZEJhdGNofTtcbiIsImltcG9ydCB7bWFrZUVudW19IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IGV4cGVyaW1lbnRzIGZyb20gJy4vdXRpbC9leHBlcmltZW50cyc7XG5cbmNvbnN0IFBhZ2VBY3Rpb24gPSBtYWtlRW51bShcbiAgJ0Ryb3BsZXRUcmFuc2l0aW9uRXJyb3InLFxuICAnRmlyZWJhc2VSYXRlTGltaXRFeGNlZWRlZCcsXG4gICdTYW5pdGl6ZWRMZXZlbEh0bWwnLFxuICAnVXNlckphdmFTY3JpcHRFcnJvcicsXG4gICdSdW5CdXR0b25DbGljaycsXG4gICdTdGFydFdlYlJlcXVlc3QnLFxuICAnU3RhdGljUmVzb3VyY2VGZXRjaEVycm9yJyxcbiAgJ1BlZ2FzdXNTZWN0aW9uc1JlZGlyZWN0JyxcbiAgJ0RhbmNlUGFydHlPbkluaXQnLFxuICAnQnJhbWJsZUVycm9yJyxcbiAgJ0JyYW1ibGVGaWxlc3lzdGVtUmVzZXRTdWNjZXNzJyxcbiAgJ0JyYW1ibGVGaWxlc3lzdGVtUmVzZXRGYWlsZWQnLFxuICAnSm90Rm9ybUZyYW1lTG9hZGVkJyxcbiAgJ0pvdEZvcm1Mb2FkRmFpbGVkJyxcbiAgJ0Jsb2NrTG9hZEZhaWxlZCcsXG4gICdNYXBib3hNYXJrZXJMb2FkRXJyb3InLFxuICAnTG9hZFNjcmlwdFByb2dyZXNzU3RhcnRlZCcsXG4gICdMb2FkU2NyaXB0UHJvZ3Jlc3NGaW5pc2hlZCcsXG4gICdTZWN0aW9uUHJvZ3Jlc3NSZW5kZXJlZFdpdGhEYXRhJyxcbiAgJ0phdmFidWlsZGVyV2ViU29ja2V0Q29ubmVjdGlvbkVycm9yJyxcbiAgJ05vVmFsaWRBbXBsaXR1ZGVFdmVudE5hbWVFcnJvcidcbik7XG5cbmNvbnN0IE1BWF9GSUVMRF9MRU5HVEggPSA0MDk1O1xuY29uc3QgUkVQT1JUX1BBR0VfU0laRSA9XG4gIGV4cGVyaW1lbnRzLmlzRW5hYmxlZCgnbG9nUGFnZVNpemUnKSB8fCBNYXRoLnJhbmRvbSgpIDwgMC4wMTtcblxuLyoqXG4gKiBXcmFwcyBhbmQgYWRkcyBmdW5jdGlvbmFsaXR5IHRvIHdpbmRvdy5uZXdyZWxpYywgd2hpY2ggaXMgb25seSBpbmNsdWRlZCBpblxuICogcHJvZHVjdGlvbi4gVGhpcyBjYXVzZXMgdXMgdG8gbm8tb3AgaW4gb3RoZXIgZW52aXJvbm1lbnRzLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgUGFnZUFjdGlvbjogUGFnZUFjdGlvbixcblxuICAvKipcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvbk5hbWUgLSBNdXN0IGJlIG9uZSBvZiB0aGUga2V5cyBmcm9tIFBhZ2VBY3Rpb25cbiAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlIC0gT2JqZWN0IGxpdGVyYWwgcmVwcmVzZW50aW5nIGNvbHVtbnMgd2Ugd2FudCB0b1xuICAgKiAgIGFkZCBmb3IgdGhpcyBhY3Rpb25cbiAgICogQHBhcmFtIHtudW1iZXJ9IFtzYW1wbGVSYXRlXSAtIE9wdGlvbmFsIHNhbXBsZSByYXRlLiBEZWZhdWx0IGlzIDEuMFxuICAgKi9cbiAgYWRkUGFnZUFjdGlvbjogZnVuY3Rpb24gKGFjdGlvbk5hbWUsIHZhbHVlLCBzYW1wbGVSYXRlKSB7XG4gICAgaWYgKHNhbXBsZVJhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FtcGxlUmF0ZSA9IDEuMDtcbiAgICB9XG5cbiAgICBpZiAoIXdpbmRvdy5uZXdyZWxpYykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghUGFnZUFjdGlvblthY3Rpb25OYW1lXSkge1xuICAgICAgY29uc29sZS5sb2coJ1Vua25vd24gYWN0aW9uTmFtZTogJyArIGFjdGlvbk5hbWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7XG4gICAgICBjb25zb2xlLmxvZygnRXhwZWN0ZWQgdmFsdWUgdG8gYmUgYW4gb2JqZWN0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPiBzYW1wbGVSYXRlKSB7XG4gICAgICAvLyBJZ25vcmUgdGhpcyBpbnN0YW5jZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAodmFyIHByb3AgaW4gdmFsdWUpIHtcbiAgICAgIC8vIE5ldyByZWxpYyBkb2VzbnQgaGFuZGxlIGJvb2xlYW5zLiBNYWtlIHRoZW0gc3RyaW5ncy5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWVbcHJvcF0gPT09ICdib29sZWFuJykge1xuICAgICAgICB2YWx1ZVtwcm9wXSA9IHZhbHVlW3Byb3BdLnRvU3RyaW5nKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWVbcHJvcF0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHZhbHVlW3Byb3BdID0gdmFsdWVbcHJvcF0uc3Vic3RyaW5nKDAsIE1BWF9GSUVMRF9MRU5HVEgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHdpbmRvdy5uZXdyZWxpYy5hZGRQYWdlQWN0aW9uKGFjdGlvbk5hbWUsIHZhbHVlKTtcbiAgfSxcblxuICAvKipcbiAgICogU2V0cyBhbiBhdHRyaWJ1dGUgdGhhdCB3aWxsIGJlIGluY2x1ZGVkIG9uIGFueSBzdWJzZXF1ZW50IGdlbmVyYXRlZCBldmVudHNcbiAgICovXG4gIHNldEN1c3RvbUF0dHJpYnV0ZTogZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICBpZiAoIXdpbmRvdy5uZXdyZWxpYykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdpbmRvdy5uZXdyZWxpYy5zZXRDdXN0b21BdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gIH0sXG5cbiAgbG9hZEZpbmlzaGVkKCkge1xuICAgIGlmICghd2luZG93Lm5ld3JlbGljKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgd2luZG93Lm5ld3JlbGljLmZpbmlzaGVkKCk7XG4gIH0sXG5cbiAgbG9nRXJyb3IoZSkge1xuICAgIGlmICghd2luZG93Lm5ld3JlbGljKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHdpbmRvdy5uZXdyZWxpYy5ub3RpY2VFcnJvcihlKTtcbiAgfSxcblxuICByZXBvcnRQYWdlU2l6ZSgpIHtcbiAgICBpZiAoIVJFUE9SVF9QQUdFX1NJWkUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHBlcmZvcm1hbmNlICYmIHBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoJ3Jlc291cmNlJyk7XG4gICAgICBsZXQgdG90YWxEb3dubG9hZFNpemUgPSAwO1xuICAgICAgbGV0IGpzRG93bmxvYWRTaXplID0gMDtcbiAgICAgIGNvbnN0IGpzRmlsZVJlZ2V4ID0gL1xcLmpzJC87XG4gICAgICBmb3IgKGNvbnN0IHJlc291cmNlIG9mIHJlc291cmNlcykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgcmVzb3VyY2UudHJhbnNmZXJTaXplID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICByZXNvdXJjZS5lbmNvZGVkQm9keVNpemUgPT09IHVuZGVmaW5lZFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdG90YWxEb3dubG9hZFNpemUgKz0gcmVzb3VyY2UudHJhbnNmZXJTaXplO1xuICAgICAgICBpZiAoanNGaWxlUmVnZXgudGVzdChyZXNvdXJjZS5uYW1lKSkge1xuICAgICAgICAgIGpzRG93bmxvYWRTaXplICs9IHJlc291cmNlLnRyYW5zZmVyU2l6ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF3aW5kb3cubmV3cmVsaWMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgd2luZG93Lm5ld3JlbGljLnNldEN1c3RvbUF0dHJpYnV0ZShcbiAgICAgICAgJ3RvdGFsRG93bmxvYWRTaXplJyxcbiAgICAgICAgdG90YWxEb3dubG9hZFNpemVcbiAgICAgICk7XG4gICAgICB3aW5kb3cubmV3cmVsaWMuc2V0Q3VzdG9tQXR0cmlidXRlKCdqc0Rvd25sb2FkU2l6ZScsIGpzRG93bmxvYWRTaXplKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmxvZ0Vycm9yKGUpO1xuICAgIH1cbiAgfSxcbn07XG4iLCIvKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19fX19fX19fX19fX19fX19fX19fX19cbiAqICAgICAgX19fX19fX19fX19fX19fX19fX19fX18tLS0tLS0tLS0tLS0tLS0tLS0tICAgICAgICAgICAgICAgICAgICAgICBgXFxcbiAqICAgIC86LS1fXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICB8fDwgPiB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX19fX19fX19fX19fX19fX19fX19fX19fX18vXG4gKiAgIHwgXFxfXy9fX19fX19fX19fX19fX19fXy0tLS0tLS0tLS0tLS0tLS0tLS0gICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICAgfCAgICAgICAgICAgICAgICAgICBUSEUgTE9SRCBPRiBUSEUgUkVEVVggU1RPUkVTICAgICAgICAgICAgICAgICAgIHxcbiAqICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICB8ICAgICBcIlRocmVlIFN0b3JlcyBmb3IgdGhlIEVsdmVuLWtpbmdzIHVuZGVyIHRoZSBza3ksICAgICAgICAgICAgIHxcbiAqICAgICB8ICAgICAgIFNldmVuIGZvciB0aGUgRHdhcmYtbG9yZHMgaW4gdGhlaXIgaGFsbHMgb2Ygc3RvbmUsICAgICAgICAgfFxuICogICAgIHwgICAgIE5pbmUgZm9yIE1vcnRhbCBNZW4gZG9vbWVkIHRvIGRpZSwgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgfCAgICAgICBPbmUgZm9yIHRoZSBEYXJrIExvcmQgb24gaGlzIGRhcmsgdGhyb25lICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICB8ICAgICBJbiB0aGUgTGFuZCBvZiBNb3Jkb3Igd2hlcmUgdGhlIFNoYWRvd3MgbGllLiAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgfCAgICAgIE9uZSBTdG9yZSB0byBydWxlIHRoZW0gYWxsLCBPbmUgU3RvcmUgdG8gZmluZCB0aGVtLCAgICAgICAgIHxcbiAqICAgICAgfCAgICAgIE9uZSBTdG9yZSB0byBicmluZyB0aGVtIGFsbCBhbmQgaW4gdGhlIGRhcmtuZXNzIGJpbmQgdGhlbSAgIHxcbiAqICAgICAgfCAgICBJbiB0aGUgTGFuZCBvZiBNb3Jkb3Igd2hlcmUgdGhlIFNoYWRvd3MgbGllLiAgICAgICAgICAgICAgICAgfFxuICogICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19fX19fX19fX19fX19fX19fX198X1xuICogICAgIHwgIF9fX19fX19fX19fX19fX19fX18tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICAgICAgICAgICAgICAgICAgICAgIGBcXFxuICogICAgIHwvYC0tXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICAgIHx8WyBdfHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fX19fX19fX19fX19fX19fX18vXG4gKiAgICAgIFxcPT09L19fX19fX19fX19fX19fX19fX18tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICpcbiAqXG4gKiBAZmlsZSBUaGUgZ2xvYmFsIHJlZHV4IHN0b3JlIC0gXCJUaGVyZSBjYW4gYmUgb25seSBvbmVcIlxuICovXG5cbmltcG9ydCBJbW11dGFibGUgZnJvbSAnaW1tdXRhYmxlJztcbmltcG9ydCBleHBlcmltZW50cyBmcm9tICcuL3V0aWwvZXhwZXJpbWVudHMnO1xuaW1wb3J0ICogYXMgcmVkdXggZnJvbSAncmVkdXgnO1xuaW1wb3J0IHJlZHV4VGh1bmsgZnJvbSAncmVkdXgtdGh1bmsnO1xuaW1wb3J0IHtjb25maWd1cmVTdG9yZX0gZnJvbSAnQHJlZHV4anMvdG9vbGtpdCc7XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIHZhciBjcmVhdGVMb2dnZXIgPSByZXF1aXJlKCdyZWR1eC1sb2dnZXInKTtcbn1cblxubGV0IHJlZHV4U3RvcmU7XG5sZXQgZ2xvYmFsUmVkdWNlcnMgPSB7fTtcblxuaWYgKElOX1VOSVRfVEVTVCkge1xuICBsZXQgX19vbGRSZWR1eFN0b3JlO1xuICBsZXQgX19vbGRHbG9iYWxSZWR1Y2VycztcblxuICBtb2R1bGUuZXhwb3J0cy5zdHViUmVkdXggPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKF9fb2xkUmVkdXhTdG9yZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnUmVkdXggc3RvcmUgaGFzIGFscmVhZHkgYmVlbiBzdHViYmVkLiBEaWQgeW91IGZvcmdldCB0byBjYWxsIHJlc3RvcmU/J1xuICAgICAgKTtcbiAgICB9XG4gICAgX19vbGRSZWR1eFN0b3JlID0gcmVkdXhTdG9yZTtcbiAgICBfX29sZEdsb2JhbFJlZHVjZXJzID0gZ2xvYmFsUmVkdWNlcnM7XG4gICAgcmVkdXhTdG9yZSA9IG51bGw7XG4gICAgZ2xvYmFsUmVkdWNlcnMgPSB7fTtcbiAgfTtcblxuICBtb2R1bGUuZXhwb3J0cy5yZXN0b3JlUmVkdXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmVkdXhTdG9yZSA9IF9fb2xkUmVkdXhTdG9yZTtcbiAgICBnbG9iYWxSZWR1Y2VycyA9IF9fb2xkR2xvYmFsUmVkdWNlcnM7XG4gICAgX19vbGRSZWR1eFN0b3JlID0gbnVsbDtcbiAgICBfX29sZEdsb2JhbFJlZHVjZXJzID0gbnVsbDtcbiAgfTtcbn1cblxuaWYgKElOX1NUT1JZQk9PSyB8fCBJTl9VTklUX1RFU1QpIHtcbiAgLy8gU3Rvcnlib29rcyBuZWVkIHRoZSBhYmlsaXR5IHRvIGNyZWF0ZSBtdWx0aXBsZSBkaXN0aW5jdCBzdG9yZXMgaW5zdGVhZCBvZlxuICAvLyB1c2luZyBhIHNpbmdsZXRvblxuICBtb2R1bGUuZXhwb3J0cy5jcmVhdGVTdG9yZVdpdGhSZWR1Y2VycyA9IGNyZWF0ZVN0b3JlV2l0aFJlZHVjZXJzO1xufVxuXG4vKipcbiAqIEdldCBhIHJlZmVyZW5jZSB0byBvdXIgcmVkdXggc3RvcmUuIElmIGl0IGRvZXNuJ3QgZXhpc3QgeWV0LCBjcmVhdGUgaXQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTdG9yZSgpIHtcbiAgaWYgKCFyZWR1eFN0b3JlKSB7XG4gICAgcmVkdXhTdG9yZSA9IGNyZWF0ZVN0b3JlV2l0aFJlZHVjZXJzKCk7XG4gICAgaWYgKGV4cGVyaW1lbnRzLmlzRW5hYmxlZCgncmVkdXhHbG9iYWxTdG9yZScpKSB7XG4gICAgICAvLyBFeHBvc2Ugb3VyIHN0b3JlIGdsb2JhbGx5LCB0byBtYWtlIGRlYnVnZ2luZyBlYXNpZXJcbiAgICAgIHdpbmRvdy5yZWR1eFN0b3JlID0gcmVkdXhTdG9yZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVkdXhTdG9yZTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgb3VyIHN0b3JlXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVN0b3JlV2l0aFJlZHVjZXJzKCkge1xuICByZXR1cm4gY3JlYXRlU3RvcmUoXG4gICAgT2JqZWN0LmtleXMoZ2xvYmFsUmVkdWNlcnMpLmxlbmd0aCA+IDAgPyBnbG9iYWxSZWR1Y2VycyA6IHMgPT4gc1xuICApO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVyIG11bHRpcGxlIHRvcC1sZXZlbCByZWR1Y2VycyB3aXRoIHRoZSBnbG9iYWwgc3RvcmUuIFRoaXMgZG9lcyBub3QgcmVtb3ZlXG4gKiBhbnkgcmVkdWNlcnMgdGhhdCBoYXZlIGJlZW4gcHJldmlvdXNseSByZWdpc3RlcmVkLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSByZWR1Y2VycyAtIGFuIG9iamVjdCBtYXBwaW5nIHVuaXF1ZSBrZXlzIHRvIHJlZHVjZXIgZnVuY3Rpb25zXG4gKiAgICAgVGhlIGtleXMgd2lsbCBiZSB1c2VkIGluIHRoZSBzdGF0ZSBvYmplY3QuXG4gKiBAcmV0dXJucyB2b2lkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclJlZHVjZXJzKHJlZHVjZXJzKSB7XG4gIGZvciAobGV0IGtleSBpbiByZWR1Y2Vycykge1xuICAgIGNvbnN0IGV4aXN0aW5nUmVkdWNlciA9IGdsb2JhbFJlZHVjZXJzW2tleV07XG4gICAgaWYgKGV4aXN0aW5nUmVkdWNlciAmJiBleGlzdGluZ1JlZHVjZXIgIT09IHJlZHVjZXJzW2tleV0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgcmVkdWNlciB3aXRoIGtleSBcIiR7a2V5fVwiIGFscmVhZHkgcmVnaXN0ZXJlZCFgKTtcbiAgICB9XG4gIH1cbiAgT2JqZWN0LmFzc2lnbihnbG9iYWxSZWR1Y2VycywgcmVkdWNlcnMpO1xuICBpZiAocmVkdXhTdG9yZSkge1xuICAgIHJlZHV4U3RvcmUucmVwbGFjZVJlZHVjZXIocmVkdXguY29tYmluZVJlZHVjZXJzKGdsb2JhbFJlZHVjZXJzKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gd2hldGhlciBvciBub3QgYSByZWR1Y2VyIHdpdGggdGhlIGdpdmVuIGtleSBoYXMgYmVlbiByZWdpc3RlcmVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoYXNSZWR1Y2VyKGtleSkge1xuICByZXR1cm4gISFnbG9iYWxSZWR1Y2Vyc1trZXldO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzdG9yZSBjb25maWd1cmVkIGZvciB1c2UgdGhlIHdheSB3ZSB3YW50IGZvciBDb2RlLm9yZy5cbiAqIEBzZWUgaHR0cDovL3JlZHV4LmpzLm9yZy9kb2NzL2FwaS9jcmVhdGVTdG9yZS5odG1sXG4gKiBAcGFyYW0geyFmdW5jdGlvbn0gcmVkdWNlclxuICogQHJldHVybiB7U3RvcmV9IENvbmZpZ3VyZWQgUmVkdXggc3RvcmUsIHJlYWR5IGZvciB1c2UuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZVN0b3JlKHJlZHVjZXIsIGluaXRpYWxTdGF0ZSkge1xuICAvLyBZb3UgaGF2ZSB0byBtYW51YWxseSBlbmFibGUgZGVidWdnaW5nLCBib3RoIHRvIGtlZXAgdGhlIGxvZ2dlciBvdXRcbiAgLy8gb2YgcHJvZHVjdGlvbiBidW5kbGVzLCBhbmQgYmVjYXVzZSBpdCBjYXVzZXMgYSBsb3Qgb2YgY29uc29sZSBub2lzZSBhbmRcbiAgLy8gbWFrZXMgb3VyIHVuaXQgdGVzdHMgZmFpbC4gVG8gZW5hYmxlLCBhcHBlbmQgP2VuYWJsZUV4cGVyaW1lbnRzPXJlZHV4TG9nZ2luZ1xuICAvLyB0byB5b3VyIHVybC4gVGhpcyB3aWxsIGFsc28gZW5hYmxlIGxvZ2dpbmcgaWYgdGhlcmUgaXMgYSBub24taW1tdXRhYmxlIG9yIG5vbi1zZXJpYWxpemFibGVcbiAgLy8gdmFsdWUgaW4gdGhlIHJlZHV4IHN0b3JlLCB3aXRoIHNvbWUgaWdub3JlcyBhbHJlYWR5IHNldCB1cCAoc2VlIGJlbG93KS5cbiAgdmFyIGVuYWJsZVJlZHV4RGVidWdnaW5nID0gZXhwZXJpbWVudHMuaXNFbmFibGVkKGV4cGVyaW1lbnRzLlJFRFVYX0xPR0dJTkcpO1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBlbmFibGVSZWR1eERlYnVnZ2luZykge1xuICAgIHZhciByZWR1eExvZ2dlciA9IGNyZWF0ZUxvZ2dlcih7XG4gICAgICBjb2xsYXBzZWQ6IHRydWUsXG4gICAgICAvLyBjb252ZXJ0IGltbXV0YWJsZS5qcyBvYmplY3RzIHRvIEpTIGZvciBsb2dnaW5nIChjb2RlIGNvcGllZCBmcm9tXG4gICAgICAvLyByZWR1eC1sb2dnZXIgcmVhZG1lKVxuICAgICAgc3RhdGVUcmFuc2Zvcm1lcjogc3RhdGUgPT4ge1xuICAgICAgICBsZXQgbmV3U3RhdGUgPSB7fTtcblxuICAgICAgICBmb3IgKHZhciBpIG9mIE9iamVjdC5rZXlzKHN0YXRlKSkge1xuICAgICAgICAgIGlmIChJbW11dGFibGUuSXRlcmFibGUuaXNJdGVyYWJsZShzdGF0ZVtpXSkpIHtcbiAgICAgICAgICAgIG5ld1N0YXRlW2ldID0gc3RhdGVbaV0udG9KUygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXdTdGF0ZVtpXSA9IHN0YXRlW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29uZmlndXJlU3RvcmUoe1xuICAgICAgcmVkdWNlcjogcmVkdWNlcixcbiAgICAgIHByZWxvYWRlZFN0YXRlOiBpbml0aWFsU3RhdGUsXG4gICAgICBtaWRkbGV3YXJlOiBnZXREZWZhdWx0TWlkZGxld2FyZSA9PlxuICAgICAgICAvLyB0aGUgZGVmYXVsdCBtaWRkbGV3YXJlIGluY2x1ZGVzIHJlZHV4IHRodW5rLCBpbW11dGFiaWxpdHkgY2hlY2ssXG4gICAgICAgIC8vIGFuZCBzZXJpYWxpemFiaWxpdHkgY2hlY2suIFNvbWUgb2Ygb3VyIHN0b3JlIGRvZXMgbm90IHBhc3MgdGhlc2UgY2hlY2tzLFxuICAgICAgICAvLyBzbyB3ZSBhcmUgaWdub3JpbmcgdGhlbSBmb3Igbm93LiBXZSBvbmx5IGVuYWJsZSB0aGlzIGluIGRldiBtb2RlXG4gICAgICAgIC8vIGJlY2F1c2UgaXQgY2F1c2VzIGNvbnNvbGUgZXJyb3JzIGlmIHNvbWV0aGluZyBmYWlscyB0aGUgY2hlY2ssIGFuZFxuICAgICAgICAvLyBjYW4gcG90ZW50aWFsbHkgY2F1c2UgYSBwYWdlIGNyYXNoIChpbiB0aGUgY2FzZSBvZiB0aGUgSlMgSW50ZXJwcmV0ZXIgYW5kIHRoZVxuICAgICAgICAvLyBpbW11dGFiaWxpdHkgY2hlY2spLlxuICAgICAgICBnZXREZWZhdWx0TWlkZGxld2FyZSh7XG4gICAgICAgICAgaW1tdXRhYmxlQ2hlY2s6IHtcbiAgICAgICAgICAgIGlnbm9yZWRQYXRoczogWydqc0ludGVycHJldGVyJywgJ2pzZGVidWdnZXInXSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlcmlhbGl6YWJsZUNoZWNrOiB7XG4gICAgICAgICAgICBpZ25vcmVkQWN0aW9uUGF0aHM6IFtcbiAgICAgICAgICAgICAgJ2Jsb2InLFxuICAgICAgICAgICAgICAnanNkZWJ1Z2dlcicsXG4gICAgICAgICAgICAgICdvYnNlcnZlcicsXG4gICAgICAgICAgICAgICdqc0ludGVycHJldGVyJyxcbiAgICAgICAgICAgICAgJ3J1bkFwcCcsXG4gICAgICAgICAgICAgICdwcm9wcy5zaG93TmV4dEhpbnQnLFxuICAgICAgICAgICAgICAncHJvcHMuYXNzZXRVcmwnLFxuICAgICAgICAgICAgICAncHJvcHMuZXhwb3J0QXBwJyxcbiAgICAgICAgICAgICAgJ3BheWxvYWQuZ2V0Q2hhbmdlcycsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgaWdub3JlZFBhdGhzOiBbXG4gICAgICAgICAgICAgICdoaWRkZW5MZXNzb24nLFxuICAgICAgICAgICAgICAnYmxvYicsXG4gICAgICAgICAgICAgICdwYWdlQ29uc3RhbnRzJyxcbiAgICAgICAgICAgICAgJ29ic2VydmVyJyxcbiAgICAgICAgICAgICAgJ3dhdGNoZWRFeHByZXNzaW9ucycsXG4gICAgICAgICAgICAgICdpbnN0cnVjdGlvbnMnLFxuICAgICAgICAgICAgICAncnVuQXBwJyxcbiAgICAgICAgICAgICAgJ2pzZGVidWdnZXInLFxuICAgICAgICAgICAgICAvYW5pbWF0aW9uTGlzdFxcLnByb3BzQnlLZXkuKlxcLmJsb2IvLFxuICAgICAgICAgICAgICAnbWFrZXInLFxuICAgICAgICAgICAgICAnZGF0YScsXG4gICAgICAgICAgICAgICdzY3JlZW5zJyxcbiAgICAgICAgICAgICAgJ2hlYWRlci5nZXRMZXZlbEJ1aWxkZXJDaGFuZ2VzJyxcbiAgICAgICAgICAgICAgJ2dldENoYW5nZXMnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KS5jb25jYXQocmVkdXhMb2dnZXIpLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGNvbmZpZ3VyZVN0b3JlKHtcbiAgICByZWR1Y2VyOiByZWR1Y2VyLFxuICAgIHByZWxvYWRlZFN0YXRlOiBpbml0aWFsU3RhdGUsXG4gICAgbWlkZGxld2FyZTogW3JlZHV4VGh1bmtdLFxuICAgIGRldlRvb2xzOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JywgLy8gb25seSBlbmFibGUgZGV2VG9vbHMgaW4gZGV2ZWxvcG1lbnRcbiAgfSk7XG59XG4iXSwibmFtZXMiOlsicHJvbWlzZSIsIkZpcmVob3NlQ2xpZW50IiwiQVdTIiwiRmlyZWhvc2UiLCJ0aGlzIiwiZmlyZWhvc2UiLCJjcmVhdGVOZXdGaXJlaG9zZSIsIl8weHIwdDEzIiwibWVzc2FnZSIsInJlcGxhY2UiLCJsZXR0ZXIiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJjaGFyQ29kZUF0IiwidG9Mb3dlckNhc2UiLCJfMHgxMmVkIiwiXzB4YjU0YTkyIiwiXzB4NGU2ODJhIiwiXzB4NDRmM2U4IiwiXzB4MzVjNTVhIiwiXzB4ZDEyZSIsIl8weDJjZWRkNSIsIl8weDUxODc4MSIsImFjY2Vzc0tleUlkIiwic2VjcmV0QWNjZXNzS2V5IiwicmVnaW9uIiwiYXBpVmVyc2lvbiIsImNvcnJlY3RDbG9ja1NrZXciLCJzaG91bGRQdXRSZWNvcmQiLCJhbHdheXNQdXQiLCJpc1Rlc3RFbnZpcm9ubWVudCIsImlzRGV2ZWxvcG1lbnRFbnZpcm9ubWVudCIsImdldEFuYWx5dGljc1V1aWQiLCJhbmFseXRpY3NfdXVpZCIsInRyeUdldExvY2FsU3RvcmFnZSIsImNyZWF0ZVV1aWQiLCJ0cnlTZXRMb2NhbFN0b3JhZ2UiLCJnZXREZXZpY2VJbmZvIiwidXNlcl9hZ2VudCIsIndpbmRvdyIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIndpbmRvd193aWR0aCIsImlubmVyV2lkdGgiLCJ3aW5kb3dfaGVpZ2h0IiwiaW5uZXJIZWlnaHQiLCJob3N0bmFtZSIsImxvY2F0aW9uIiwiZnVsbF9wYXRoIiwiaHJlZiIsImdldExvY2FsZSIsImFwcE9wdGlvbnMiLCJsb2NhbGUiLCJhZGRDb21tb25WYWx1ZXMiLCJkYXRhIiwiaW5jbHVkZVVzZXJJZCIsInVzZVByb2dyZXNzU2NyaXB0SWQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJnZXRFbnZpcm9ubWVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0ZSIsImdldFN0b3JlIiwiZ2V0U3RhdGUiLCJjb25zdGFudHMiLCJwYWdlQ29uc3RhbnRzIiwiY3VycmVudFVzZXJJZCIsImN1cnJlbnRVc2VyIiwidXNlcklkIiwicHJvZ3Jlc3MiLCJzY3JpcHRJZCIsInBhcnNlSW50IiwiY3VycmVudExldmVsSWQiLCJoYW5kbGVFcnJvciIsInJlcXVlc3REYXRhIiwiZXJyb3IiLCIkIiwiYWpheCIsInVybCIsIm9yaWdpbmFsX2RhdGEiLCJlcnJvcl90ZXh0IiwiY29udGVudFR5cGUiLCJtZXRob2QiLCJkYXRhVHlwZSIsInB1dFJlY29yZCIsIm9wdGlvbnMiLCJjYWxsYmFjayIsImJpbmQiLCJjb25zb2xlIiwiZ3JvdXBDb2xsYXBzZWQiLCJsb2ciLCJncm91cEVuZCIsInZhbGlkYXRlRmlyZWhvc2VEYXRhU2l6ZSIsIkRlbGl2ZXJ5U3RyZWFtTmFtZSIsIlJlY29yZCIsIkRhdGEiLCJlcnIiLCJwdXRSZWNvcmRCYXRjaCIsIm1hcCIsInJlY29yZCIsIkFkZENvbW1vblZhbHVlcyIsImJhdGNoIiwiUmVjb3JkcyIsImpzb25fc2l6ZSIsIkJsb2IiLCJkYXRhX2pzb24iLCJzaXplIiwic3RyaW5nX3NpemUiLCJkYXRhX3N0cmluZyIsImxvZ1RvQ2xvdWQiLCJsb2dFcnJvciIsImdldFNpbmdsZXRvbiIsIlByb21pc2UiLCJhbGwiLCJ0aGVuIiwicmVzb2x2ZSIsImZpcmVob3NlQ2xpZW50IiwiUGFnZUFjdGlvbiIsIm1ha2VFbnVtIiwiUkVQT1JUX1BBR0VfU0laRSIsImV4cGVyaW1lbnRzIiwiaXNFbmFibGVkIiwiTWF0aCIsInJhbmRvbSIsIm1vZHVsZSIsImV4cG9ydHMiLCJhZGRQYWdlQWN0aW9uIiwiYWN0aW9uTmFtZSIsInZhbHVlIiwic2FtcGxlUmF0ZSIsInVuZGVmaW5lZCIsIm5ld3JlbGljIiwicHJvcCIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic2V0Q3VzdG9tQXR0cmlidXRlIiwia2V5IiwibG9hZEZpbmlzaGVkIiwiZmluaXNoZWQiLCJlIiwibm90aWNlRXJyb3IiLCJyZXBvcnRQYWdlU2l6ZSIsInJlc291cmNlcyIsInBlcmZvcm1hbmNlIiwiZ2V0RW50cmllc0J5VHlwZSIsInRvdGFsRG93bmxvYWRTaXplIiwianNEb3dubG9hZFNpemUiLCJqc0ZpbGVSZWdleCIsInJlc291cmNlIiwidHJhbnNmZXJTaXplIiwiZW5jb2RlZEJvZHlTaXplIiwidGVzdCIsIm5hbWUiLCJyZWR1eFN0b3JlIiwiY3JlYXRlU3RvcmVXaXRoUmVkdWNlcnMiLCJoYXNSZWR1Y2VyIiwiZ2xvYmFsUmVkdWNlcnMiLCJyZWdpc3RlclJlZHVjZXJzIiwicmVkdWNlcnMiLCJleGlzdGluZ1JlZHVjZXIiLCJFcnJvciIsIk9iamVjdCIsImFzc2lnbiIsInJlcGxhY2VSZWR1Y2VyIiwicmVkdXgiLCJjb21iaW5lUmVkdWNlcnMiLCJjcmVhdGVTdG9yZSIsInJlZHVjZXIiLCJpbml0aWFsU3RhdGUiLCJSRURVWF9MT0dHSU5HIiwicHJvY2VzcyIsImNvbmZpZ3VyZVN0b3JlIiwicHJlbG9hZGVkU3RhdGUiLCJtaWRkbGV3YXJlIiwicmVkdXhUaHVuayIsImRldlRvb2xzIiwia2V5cyIsImxlbmd0aCIsInMiXSwic291cmNlUm9vdCI6IiJ9